---
description: WebView2 アプリケーションでユーザー データ フォルダーを管理する方法について説明します。
title: WebView2 アプリケーションでユーザー データ フォルダーを管理します。
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 05/06/2021
ms.topic: conceptual
ms.prod: microsoft-edge
ms.technology: webview
keywords: IWebView2、IWebView2WebView、Webview2、Webview、win32 アプリ、win32、edge、ICoreWebView2、ICoreWebView2Host、ブラウザー コントロール、エッジ html、ユーザー データ フォルダー
ms.openlocfilehash: a6399e59f153d4446946937461e61667f325f4ae
ms.sourcegitcommit: 777b16ef10363f2dfd755f115ee2d4c81a8de46f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2021
ms.locfileid: "11536033"
---
# <a name="manage-the-user-data-folder"></a><span data-ttu-id="2d0d1-104">ユーザー データ フォルダーの管理</span><span class="sxs-lookup"><span data-stu-id="2d0d1-104">Manage the User Data Folder</span></span>  

<span data-ttu-id="2d0d1-105">WebView2 アプリケーションは、ユーザー データ フォルダーを操作して、Cookie、アクセス許可、キャッシュされたリソースなどのブラウザー データを格納します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-105">WebView2 applications interact with user data folders to store browser data, such as cookies, permissions, and cached resources.</span></span>  <span data-ttu-id="2d0d1-106">WebView2 コントロールの各インスタンスは、ユーザー データ フォルダーに関連付けられる。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-106">Each instance of a WebView2 control is associated with a user data folder.</span></span>  <span data-ttu-id="2d0d1-107">各ユーザー データ フォルダーは、ユーザーに固有です。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-107">Each user data folder is unique to a user.</span></span>  

## <a name="best-practices"></a><span data-ttu-id="2d0d1-108">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="2d0d1-108">Best Practices</span></span>  

<span data-ttu-id="2d0d1-109">ユーザー データ フォルダーは、WebView2 によって自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-109">User data folders are created automatically by WebView2.</span></span>  <span data-ttu-id="2d0d1-110">WebView2 開発者は、ユーザー データ フォルダーの有効期間を制御します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-110">WebView2 developers control the lifetime of the user data folder.</span></span>  <span data-ttu-id="2d0d1-111">アプリケーションがアプリケーション セッションからユーザー データを再使用する場合は、ユーザー データ フォルダーの保存を検討してください。それ以外の場合は削除できます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-111">If your application re-uses user data from application sessions, consider saving the user data folders, otherwise you may delete them.</span></span>  <span data-ttu-id="2d0d1-112">ユーザー データ フォルダーを管理する方法を決定する場合は、次のシナリオを検討してください。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-112">Consider the following scenarios when deciding how to manage your user data folders:</span></span>  

*   <span data-ttu-id="2d0d1-113">同じユーザーがアプリケーションを繰り返し使用し、アプリケーションの Web コンテンツがユーザーのデータに依存している場合は、ユーザー データ フォルダーを保存します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-113">If the same user uses your application repeatedly, and the web content of the application relies on the user's data, save the user data folder.</span></span>  <span data-ttu-id="2d0d1-114">複数のユーザーがアプリケーションを繰り返し使用する場合は、新しいユーザーごとに新しいユーザー データ フォルダーを作成し、各ユーザーのユーザー データ フォルダーを保存します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-114">If multiple users use your application repeatedly, create a new user data folder for each new user, and save the user data folder of each user.</span></span>
*   <span data-ttu-id="2d0d1-115">アプリケーションに繰り返しユーザーが存在しない場合は、ユーザーごとに新しいユーザー データ フォルダーを作成し、前のユーザー データ フォルダーを削除します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-115">If your application does not have repeat users, create a new user data folder for each user, and delete the previous user data folder.</span></span>  
    
## <a name="create-user-data-folders"></a><span data-ttu-id="2d0d1-116">ユーザー データ フォルダーの作成</span><span class="sxs-lookup"><span data-stu-id="2d0d1-116">Create user data folders</span></span>  

<span data-ttu-id="2d0d1-117">ユーザー データ フォルダーの場所を指定するには `userDataFolder` [、ICoreWebView2Environment](/microsoft-edge/webview2/reference/win32/icorewebview2environment) \(Win32\) または [CoreWebView2Environment](/dotnet/api/microsoft.web.webview2.core.corewebview2environment) \(.NET\) を呼び出す際にパラメーターを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-117">To specify the location of the user data folder, include the `userDataFolder` parameter when calling [ICoreWebView2Environment](/microsoft-edge/webview2/reference/win32/icorewebview2environment) \(Win32\) or [CoreWebView2Environment](/dotnet/api/microsoft.web.webview2.core.corewebview2environment) \(.NET\).</span></span>  <span data-ttu-id="2d0d1-118">作成後、WebView2 コントロールのブラウザー データは 、 のサブフォルダーに格納されます `userDataFolder` 。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-118">After creation, browser data from your WebView2 control is stored in a subfolder of `userDataFolder`.</span></span>  <span data-ttu-id="2d0d1-119">指定しない場合、WebView2 は次のように既定の場所にユーザー `userDataFolder` データ フォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-119">When `userDataFolder` is not specified, WebView2 creates user data folders at default locations as follows:</span></span>  

*   <span data-ttu-id="2d0d1-120">パッケージ化されたWindowsストア アプリの場合、既定のユーザー フォルダーはパッケージのフォルダー `ApplicationData\LocalFolder` 内のサブフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-120">For packaged Windows Store apps, the default user folder is the `ApplicationData\LocalFolder` subfolder in the package's  folder.</span></span>  
*   <span data-ttu-id="2d0d1-121">既存のデスクトップ アプリの場合、既定のユーザー データ フォルダーはアプリケーションの exe パス + です `.WebView2` 。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-121">For existing desktop apps, the default user data folder is the exe path of your application + `.WebView2`.</span></span>  <span data-ttu-id="2d0d1-122">既定を使用する代わりに、ユーザー データ フォルダーを指定し、他のすべてのアプリ データが格納されている同じフォルダーに作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-122">Instead of using the default, we recommend that you specify a user data folder, and that you create it in the same folder where all other app data is stored.</span></span>  
    
## <a name="delete-user-data-folders"></a><span data-ttu-id="2d0d1-123">ユーザー データ フォルダーの削除</span><span class="sxs-lookup"><span data-stu-id="2d0d1-123">Delete user data folders</span></span>  

<span data-ttu-id="2d0d1-124">アプリケーションでユーザー データ フォルダーを削除する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-124">Your application may need to delete user data folders:</span></span>  

*   <span data-ttu-id="2d0d1-125">アプリをアンインストールする場合。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-125">When uninstalling your app.</span></span>  <span data-ttu-id="2d0d1-126">パッケージ化されたストア アプリをアンインストールするWindows、Windowsユーザー データ フォルダーが自動的に削除されます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-126">If you are uninstalling packaged Windows Store apps, Windows deletes user data folders automatically.</span></span>  
*   <span data-ttu-id="2d0d1-127">すべての閲覧データ履歴をクリーンアップする。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-127">To clean up all browsing data history.</span></span>  
*   <span data-ttu-id="2d0d1-128">データの破損から回復する。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-128">To recover from data corruption.</span></span>  
*   <span data-ttu-id="2d0d1-129">以前のセッション データを削除するには。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-129">To remove previous session data.</span></span>  
    
> [!NOTE]
> <span data-ttu-id="2d0d1-130">WebView2 アプリケーションを閉じた後も、ユーザー データ フォルダー内のファイルが使用されている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-130">Files in user data folders may still be in use after the WebView2 application is closed.</span></span>  <span data-ttu-id="2d0d1-131">この状況では、フォルダーを削除する前に、ブラウザー プロセスとすべての子プロセスが終了するのを待ちます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-131">In this situation, wait for the browser process and all child processes to exit before deleting the folder.</span></span>  <span data-ttu-id="2d0d1-132">WebView2 のプロパティを使用して、ブラウザー プロセスの `BrowserProcessId` プロセス ID を取得できます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-132">You may retrieve the process id of the browser process using the `BrowserProcessId` property of the WebView2.</span></span>  

## <a name="share-user-data-folders"></a><span data-ttu-id="2d0d1-133">ユーザー データ フォルダーの共有</span><span class="sxs-lookup"><span data-stu-id="2d0d1-133">Share user data folders</span></span>  

<span data-ttu-id="2d0d1-134">WebView2 コントロールは、次の場合に同じユーザー データ フォルダーを共有できます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-134">WebView2 controls may share the same user data folders to:</span></span>  

*   <span data-ttu-id="2d0d1-135">[1 つのブラウザー プロセスで](../concepts/process-model.md) 実行することで、システム リソースを最適化します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-135">[Optimize system resources](../concepts/process-model.md) by running in one browser process.</span></span>  
*   <span data-ttu-id="2d0d1-136">ブラウザーの履歴とキャッシュされたリソースを共有します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-136">Share browser history and cached resources.</span></span>  
    
<span data-ttu-id="2d0d1-137">ユーザー データ フォルダーを共有する場合は、次の点を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-137">Consider the following when sharing user data folders:</span></span>  

1.  <span data-ttu-id="2d0d1-138">webView2 コントロールを再作成して [、add_NewBrowserVersionAvailable](/microsoft-edge/webview2/reference/win32/icorewebview2environment#add_newbrowserversionavailable) \(Win32\) イベントまたは [NewBrowserVersionAvailable](/dotnet/api/microsoft.web.webview2.core.corewebview2environment.newbrowserversionavailable) \(.NET\) イベントを使用してブラウザー のバージョンを更新する場合は、ブラウザー プロセスが同じユーザー データ フォルダーを共有する WebView2 コントロールを終了して閉じる必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-138">When re-creating WebView2 controls to update browser versions using [add_NewBrowserVersionAvailable](/microsoft-edge/webview2/reference/win32/icorewebview2environment#add_newbrowserversionavailable) \(Win32\) or [NewBrowserVersionAvailable](/dotnet/api/microsoft.web.webview2.core.corewebview2environment.newbrowserversionavailable) \(.NET\) events, ensure browser processes exit and close WebView2 controls that share the same user data folder.</span></span>  <span data-ttu-id="2d0d1-139">ブラウザー プロセスのプロセス ID を取得するには `BrowserProcessId` 、WebView2 コントロールのプロパティを使用します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-139">To retrieve the process id of the browser process, use the `BrowserProcessId` property of the WebView2 control.</span></span>  
1.  <span data-ttu-id="2d0d1-140">同じユーザー データ フォルダーを共有する WebView2 コントロールでは [、ICoreWebView2Environment](/microsoft-edge/webview2/reference/win32/icorewebview2environment) \(Win32\) または [CoreWebView2Environment](/dotnet/api/microsoft.web.webview2.core.corewebview2environment) \(.NET\) に同じオプションを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-140">WebView2 controls that share the same user data folder must use the same options for [ICoreWebView2Environment](/microsoft-edge/webview2/reference/win32/icorewebview2environment) \(Win32\) or [CoreWebView2Environment](/dotnet/api/microsoft.web.webview2.core.corewebview2environment) \(.NET\).</span></span>  <span data-ttu-id="2d0d1-141">指定しない場合、WebView2 の作成は失敗します `HRESULT_FROM_WIN32(ERROR_INVALID_STATE)` 。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-141">If not, the WebView2 creation will fail with `HRESULT_FROM_WIN32(ERROR_INVALID_STATE)`.</span></span>  
    
<span data-ttu-id="2d0d1-142">アプリケーションの異なる部分を分離したり、WebView2 コントロール間でデータを共有する必要が生じない場合は、別のユーザー データ フォルダーを使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-142">To isolate different parts of your application or when sharing data between WebView2 controls is not needed, you may choose to use different user data folders.</span></span>  <span data-ttu-id="2d0d1-143">たとえば、アプリケーションは 2 つの WebView2 コントロールで構成され、1 つは提供情報を表示し、もう 1 つはアプリケーション コンテンツを表示します。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-143">For example, an application may consist of two WebView2 controls, one for displaying an advertisement and the other for displaying application content.</span></span>  <span data-ttu-id="2d0d1-144">このシナリオでは、開発者は WebView2 コントロールごとに異なるユーザー データ フォルダーを使用することを選択できます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-144">In this scenario, developers may opt to use different user data folders for each WebView2 control.</span></span>  

> [!NOTE]
> <span data-ttu-id="2d0d1-145">各 WebView2 ブラウザー プロセスでは、追加のメモリとディスク領域が消費されます。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-145">Each WebView2 browser process consumes additional memory and disk space.</span></span>  <span data-ttu-id="2d0d1-146">したがって、同時に多数の異なるユーザー データ フォルダーを使用して WebView2s を実行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="2d0d1-146">Therefore, we recommend not running WebView2s with too many different user data folders at the same time.</span></span>  
