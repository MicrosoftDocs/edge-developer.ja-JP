---
description: WebView2 アプリケーションを開発するときに使用する開発のベスト プラクティスについて説明します。
title: WebView2 開発のベスト プラクティス
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 05/11/2021
ms.topic: conceptual
ms.prod: microsoft-edge
ms.technology: webview
keywords: WebView2、Webview2、WebView、Webview、エッジ、ベスト プラクティス
ms.openlocfilehash: 7e8c6746e864b474c2987817c521224499a95e1f
ms.sourcegitcommit: 5ae09b1ad6cd576c9fec12538b23cd849861f2b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/01/2021
ms.locfileid: "11627979"
---
# <a name="webview2-development-best-practices"></a><span data-ttu-id="e3c36-104">WebView2 開発のベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="e3c36-104">WebView2 development best practices</span></span>  

<span data-ttu-id="e3c36-105">すべての開発チームは、アプリケーションを構築する際にさまざまなプラクティスに従います。</span><span class="sxs-lookup"><span data-stu-id="e3c36-105">Every development team follows different practices when building their application.</span></span> <span data-ttu-id="e3c36-106">WebView2 アプリケーションをビルドする場合は、以下の方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e3c36-106">When you build WebView2 applications, there are practices we recommend you follow.</span></span> <span data-ttu-id="e3c36-107">この記事では、運用ベースの WebView2 アプリケーションを構築する際の推奨事項とベスト プラクティスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-107">This article outlines those recommendations and best practices for you when building production-based WebView2 applications.</span></span>

## <a name="use-evergreen-webview2-runtime-recommended"></a><span data-ttu-id="e3c36-108">Evergreen WebView2 ランタイムの使用 (推奨)</span><span class="sxs-lookup"><span data-stu-id="e3c36-108">Use Evergreen WebView2 Runtime (recommended)</span></span>  

<span data-ttu-id="e3c36-109">固定バージョンには、厳密な互換性要件を持つアプリの使用例があります。通常、Evergreen WebView2 ランタイムの使用をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e3c36-109">While Fixed Version has its use cases for apps that have strict compatibility requirements, we generally recommend using the Evergreen WebView2 Runtime.</span></span>  <span data-ttu-id="e3c36-110">Evergreen WebView2 ランタイムは自動的に更新され、WebView2 アプリケーションで使用できる最新の機能とセキュリティ パッチが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e3c36-110">The Evergreen WebView2 Runtime updates automatically and includes the latest features and security patches available to your WebView2 application.</span></span> <span data-ttu-id="e3c36-111">Evergreen WebView2 ランタイムでは、ディスク上の記憶域も少なくする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-111">The Evergreen WebView2 Runtime also requires less storage space on the disk.</span></span>

<span data-ttu-id="e3c36-112">WebView2 アプリケーションを使用する前に、Evergreen WebView2 ランタイムがインストールされていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e3c36-112">Ensure the Evergreen WebView2 Runtime is installed before using your WebView2 application.</span></span>  <span data-ttu-id="e3c36-113">詳細については [、「Evergreen WebView2 ランタイムの展開」に移動します][Webview2ConceptsDistributionDeployingEvergreenWebview2Runtime]。</span><span class="sxs-lookup"><span data-stu-id="e3c36-113">For more information, navigate to [Deploying the Evergreen WebView2 Runtime][Webview2ConceptsDistributionDeployingEvergreenWebview2Runtime].</span></span>  

## <a name="run-compatibility-tests-regularly-when-using-the-evergreen-webview2-runtime"></a><span data-ttu-id="e3c36-114">Evergreen WebView2 ランタイムを使用する場合は、互換性テストを定期的に実行する</span><span class="sxs-lookup"><span data-stu-id="e3c36-114">Run compatibility tests regularly when using the Evergreen WebView2 Runtime</span></span>

<span data-ttu-id="e3c36-115">Evergreen WebView2 ランタイムを使用する場合、ランタイムは自動的に更新されます。そのため、互換性テストを定期的に実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-115">When using the Evergreen WebView2 Runtime, the runtime updates automatically, so you must regularly run compatibility tests.</span></span> <span data-ttu-id="e3c36-116">WebView2 コントロールの Web コンテンツを、安定しないバージョンの Microsoft Edge に対してテストし、WebView2 アプリケーションが期待通り動作します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-116">Test the web content in the WebView2 control against the non-stable versions of Microsoft Edge, to ensure that your WebView2 application works as expected.</span></span>

<span data-ttu-id="e3c36-117">このガイダンスは、Web 開発者に提供するガイダンスに似ています。</span><span class="sxs-lookup"><span data-stu-id="e3c36-117">This guidance is similar to the guidance that we give to web developers.</span></span> <span data-ttu-id="e3c36-118">詳細については、「Evergreen モードで [互換性を持ち続け」に移動します][Webview2ConceptsDistributionStayCompatibleEvergreenMode]。</span><span class="sxs-lookup"><span data-stu-id="e3c36-118">For more information, navigate to [Stay compatible in Evergreen mode][Webview2ConceptsDistributionStayCompatibleEvergreenMode].</span></span>

## <a name="ensure-apis-are-supported-by-the-installed-webview2-runtime"></a><span data-ttu-id="e3c36-119">インストールされている WebView2 ランタイムで API がサポートされていることを確認する</span><span class="sxs-lookup"><span data-stu-id="e3c36-119">Ensure APIs are supported by the installed WebView2 Runtime</span></span>

<span data-ttu-id="e3c36-120">WebView2 アプリケーションの実行には、Webview2 SDK と、コンピューターにインストールされている WebView2 ランタイムの両方が必要です。</span><span class="sxs-lookup"><span data-stu-id="e3c36-120">WebView2 applications need both a Webview2 SDK, and a WebView2 Runtime installed on the computer to run.</span></span> <span data-ttu-id="e3c36-121">SDK とランタイムの両方がバージョン管理されています。</span><span class="sxs-lookup"><span data-stu-id="e3c36-121">Both the SDK and the runtime are versioned.</span></span> <span data-ttu-id="e3c36-122">API は WebView2 に継続的に追加され続けるので、新しい API をサポートするために、ランタイムの新しいバージョンもリリースされます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-122">Since APIs are continually being added to WebView2, new versions of the runtime are also released to support the new APIs.</span></span> <span data-ttu-id="e3c36-123">WebView2 アプリケーションで使用される API が、コンピューターにインストールされている WebView2 ランタイムによってサポートされていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-123">Make sure the APIs that are used by your WebView2 application are supported by the WebView2 Runtime that's installed on the computer.</span></span> 

<span data-ttu-id="e3c36-124">Evergreen WebView2 ランタイムを使用する場合、ランタイムが最新バージョンを使用するために更新されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-124">If you use the Evergreen WebView2 Runtime, there are some scenarios where the runtime may not be updated to use the latest version.</span></span> <span data-ttu-id="e3c36-125">たとえば、ユーザーがインターネットにアクセスできない場合、ランタイムは、その環境では自動的に更新されません。</span><span class="sxs-lookup"><span data-stu-id="e3c36-125">For example, when users don't have internet access, the runtime isn't automatically updated in that environment.</span></span> <span data-ttu-id="e3c36-126">さらに、一部のグループ ポリシーを使用すると、WebView2 の更新が一時停止されます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-126">Additionally, using some group policies pause WebView2 updates.</span></span> <span data-ttu-id="e3c36-127">WebView2 アプリケーションに更新プログラムをプッシュすると、インストールされているランタイムで使用できない新しい API が使用され、アプリケーションが壊れる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-127">When you push an update to your WebView2 application, the application may break because it uses newer APIs that aren't available in the installed runtime.</span></span>   
 
<span data-ttu-id="e3c36-128">この状況を解決するには、コードが API を呼び出す前に、インストールされているランタイムで API の可用性をテストできます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-128">To solve this situation, you can test for the availability of the APIs in the installed runtime, before your code calls the API.</span></span> <span data-ttu-id="e3c36-129">この新しい機能のテストは、新しい Web API を使用する前にサポートされている機能を検出する他の Web 開発のベスト プラクティスと似ています。</span><span class="sxs-lookup"><span data-stu-id="e3c36-129">This test for newer functionality is similar to other web development best practices that detect supported features before using new web APIs.</span></span> <span data-ttu-id="e3c36-130">インストールされているランタイムで API の可用性をテストするには、次の値を使用します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-130">To test for API availability in the installed runtime, use:</span></span>  

*   <span data-ttu-id="e3c36-131">`queryinterface`C/C++ の場合。</span><span class="sxs-lookup"><span data-stu-id="e3c36-131">The `queryinterface` in C/C++.</span></span> 
*   <span data-ttu-id="e3c36-132">.NET または WinUI の try/catch ブロック。</span><span class="sxs-lookup"><span data-stu-id="e3c36-132">A try/catch block in .NET or WinUI.</span></span> 
    
<span data-ttu-id="e3c36-133">詳細については [、「Determine WebView2 ランタイム要件」に移動します][Webview2ConceptsVersioningDetermineWebview2RuntimeRequirement]。</span><span class="sxs-lookup"><span data-stu-id="e3c36-133">For more information, navigate to [Determine WebView2 Runtime requirement][Webview2ConceptsVersioningDetermineWebview2RuntimeRequirement].</span></span>  

## <a name="update-the-fixed-version-runtime"></a><span data-ttu-id="e3c36-134">固定バージョン ランタイムの更新</span><span class="sxs-lookup"><span data-stu-id="e3c36-134">Update the Fixed Version Runtime</span></span>  

<span data-ttu-id="e3c36-135">固定バージョン ランタイムを使用する場合は、セキュリティリスクを軽減するためにランタイムを定期的に更新してください。</span><span class="sxs-lookup"><span data-stu-id="e3c36-135">If you use the Fixed Version Runtime, ensure you update your runtime regularly to reduce any potential security risk.</span></span> <span data-ttu-id="e3c36-136">Webview2 アプリケーションでサードパーティ製のコンテンツを使用する場合は、常に信頼されていないコンテンツを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="e3c36-136">When using 3rd-party content in Webview2 applications, always consider the content untrusted.</span></span>  <span data-ttu-id="e3c36-137">詳細については、「固定バージョン配布 [モード」に移動します][Webview2ConceptsDistributionFixedVersionDistributionMode]。</span><span class="sxs-lookup"><span data-stu-id="e3c36-137">For more information, navigate to [Fixed Version distribution mode][Webview2ConceptsDistributionFixedVersionDistributionMode].</span></span>  

## <a name="manage-new-versions-of-the-runtime"></a><span data-ttu-id="e3c36-138">ランタイムの新しいバージョンを管理する</span><span class="sxs-lookup"><span data-stu-id="e3c36-138">Manage new versions of the runtime</span></span>  

<span data-ttu-id="e3c36-139">Evergreen WebView2 ランタイムの新しいバージョンがデバイスにダウンロードされると、実行中の WebView2 アプリケーションは、ブラウザー プロセスがリリースされるまで、前のランタイムを引き続き使用します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-139">When a new version of the Evergreen WebView2 Runtime is downloaded to the device, any WebView2 applications that are running continue to use the previous runtime, until the browser process is released.</span></span>  <span data-ttu-id="e3c36-140">この動作により、アプリケーションは継続的に実行され、以前のランタイムが削除されません。</span><span class="sxs-lookup"><span data-stu-id="e3c36-140">This behavior allows applications to run continuously, and prevents the previous runtime from being deleted.</span></span>  <span data-ttu-id="e3c36-141">新しいバージョンのランタイムを使用するには、以前の WebView2 環境オブジェクトへのすべての参照を解放するか、アプリケーションを再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-141">To use the new version of the runtime, you'll need to release all references to the previous WebView2 environment objects or restart your application.</span></span>  <span data-ttu-id="e3c36-142">次に新しい WebView2 環境を作成すると、新しいバージョンが使用されます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-142">The next time you create a new WebView2 environment, it will use the new version.</span></span>

<span data-ttu-id="e3c36-143">新しいバージョンが使用可能な場合は、アプリケーションを再起動するユーザーに通知するなどのアクションを自動的に実行できます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-143">When a new version is available, you can automatically take action, such as notifying the user to restart the application.</span></span>  <span data-ttu-id="e3c36-144">新しいバージョンが使用可能な状態を検出するには、コードで [add_NewBrowserVersionAvailable(Win32)][Webview2ReferenceaddNewBrowserVersionAvailable] イベントまたは [CoreWebView2Environment.NewBrowserVersionAvailable(.NET)][Webview2ReferenceNewBrowserVersionAvailable] イベントを使用できます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-144">To detect that a new version is available, you can use the [add_NewBrowserVersionAvailable(Win32)][Webview2ReferenceaddNewBrowserVersionAvailable] or [CoreWebView2Environment.NewBrowserVersionAvailable(.NET)][Webview2ReferenceNewBrowserVersionAvailable] event in your code.</span></span> <span data-ttu-id="e3c36-145">コードがアプリケーションの再起動を処理する場合は、WebView2 アプリケーションが終了する前にユーザー状態を保存してください。</span><span class="sxs-lookup"><span data-stu-id="e3c36-145">If your code handles restarting the application, consider saving the user state before the WebView2 application exits.</span></span>  

## <a name="manage-the-lifetime-of-the-user-data-folder"></a><span data-ttu-id="e3c36-146">ユーザー データ フォルダーの有効期間を管理する</span><span class="sxs-lookup"><span data-stu-id="e3c36-146">Manage the lifetime of the user data folder</span></span> 
<span data-ttu-id="e3c36-147">WebView2 アプリは、Cookie、資格情報、アクセス許可などのデータを格納するユーザー データ フォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-147">WebView2 apps create a user data folder to store data such as cookies, credentials, and permissions.</span></span>  <span data-ttu-id="e3c36-148">フォルダーを作成した後、アプリはユーザー データ フォルダーの有効期間を管理します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-148">After creating the folder, your app is responsible for managing the lifetime of the user data folder.</span></span>  <span data-ttu-id="e3c36-149">たとえば、アプリがアンインストールされた場合、アプリはクリーンアップを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-149">For example, your app must do cleanup when the app is uninstalled.</span></span>  <span data-ttu-id="e3c36-150">詳細については、「ユーザー データ フォルダー [の管理」に移動します][Webview2ConceptsUserDataFolder]。</span><span class="sxs-lookup"><span data-stu-id="e3c36-150">For more information, navigate to [Managing the user data folder][Webview2ConceptsUserDataFolder].</span></span>  

## <a name="handle-runtime-process-failures"></a><span data-ttu-id="e3c36-151">ランタイム プロセスのエラーを処理する</span><span class="sxs-lookup"><span data-stu-id="e3c36-151">Handle runtime-process failures</span></span>
<span data-ttu-id="e3c36-152">WebView2 アプリはイベントをリッスンして処理する必要があります。そのため、WebView2 アプリ プロセスをサポートするランタイム プロセスのエラーからアプリを `ProcessFailed` 回復できます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-152">Your WebView2 app should listen for and handle the `ProcessFailed` event, so the app can recover from failures of runtime processes that support the WebView2 app process.</span></span>

<span data-ttu-id="e3c36-153">WebView2 アプリは、アプリ プロセスと共に実行されるランタイム プロセスのコレクションによってサポートされます。</span><span class="sxs-lookup"><span data-stu-id="e3c36-153">WebView2 apps are supported by a collection of runtime processes that run alongside the app process.</span></span> <span data-ttu-id="e3c36-154">これらのサポートランタイム プロセスは、メモリの使い切れやユーザーによる終了など、さまざまな理由で失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e3c36-154">These supporting runtime processes can fail for various reasons, such as running out of memory, or being terminated by the user.</span></span> <span data-ttu-id="e3c36-155">サポートするランタイム プロセスが失敗すると、WebView2 は [ProcessFailed][WebView2ProcessFailedEvent]イベントを発生してアプリケーションに通知します。</span><span class="sxs-lookup"><span data-stu-id="e3c36-155">When a supporting runtime process fails, WebView2 notifies the application by raising the [ProcessFailed event][WebView2ProcessFailedEvent].</span></span>

## <a name="follow-recommended-webview2-security-best-practices"></a><span data-ttu-id="e3c36-156">推奨される WebView2 セキュリティのベスト プラクティスに従う</span><span class="sxs-lookup"><span data-stu-id="e3c36-156">Follow recommended WebView2 security best practices</span></span> 
<span data-ttu-id="e3c36-157">WebView2 アプリケーションの場合は、推奨される WebView2 セキュリティのベスト プラクティスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="e3c36-157">For any WebView2 application, ensure you follow our recommended WebView2 security best practices.</span></span>  <span data-ttu-id="e3c36-158">詳細については、「セキュリティで保護された [WebView2 アプリケーションを開発するためのベスト プラクティス」に移動します][Webview2ConceptsSecurity]。</span><span class="sxs-lookup"><span data-stu-id="e3c36-158">For more information, navigate to [Best practices for developing secure WebView2 applications][Webview2ConceptsSecurity].</span></span>  

<!-- links -->  

[Webview2ConceptsDistributionDeployingEvergreenWebview2Runtime]: ../concepts/distribution.md#deploying-the-evergreen-webview2-runtime "Evergreen WebView2 ランタイムの展開 - WebView2 ランタイムを使用したアプリ|Microsoft Docs"  
[Webview2ConceptsDistributionFixedVersionDistributionMode]: ../concepts/distribution.md#fixed-version-distribution-mode "固定バージョン配布モード - WebView2 アプリケーションを使用したアプリ|Microsoft Docs"  
[Webview2ConceptsDistributionStayCompatibleEvergreenMode]: ../concepts/distribution.md#stay-compatible-in-evergreen-mode "Evergreen モードで互換性を持つ - WebView2 を使用したアプリの配布 |Microsoft Docs"  
[Webview2ConceptsSecurity]: ../concepts/security.md "セキュリティで保護された WebView2 アプリケーションを開発するためのベストプラクティス |Microsoft Docs"  
[Webview2ConceptsUserDataFolder]: ../concepts/user-data-folder.md "ユーザー データ フォルダーの管理|Microsoft Docs"  
[Webview2ConceptsVersioningDetermineWebview2RuntimeRequirement]: ../concepts/versioning.md#determine-webview2-runtime-requirement "WebView2 ランタイム要件の決定 - WebView2 SDK のバージョンの|Microsoft Docs"  
[Webview2GetStartedWin32]: ../get-started/win32.md "WebView2 の使用を開始する|Microsoft Docs"  
[Webview2GetStartedWinforms]: ../get-started/winforms.md "WebView2 の使用を開始するには、Windowsフォーム|Microsoft Docs"  
[Webview2GetStartedWinui]: ../get-started/winui.md "WinUI 3 (プレビュー) の WebView2 の使用を開始|Microsoft Docs"  
[Webview2GetStartedWpf]: ../get-started/wpf.md "WPF サーバーでの WebView2 の|Microsoft Docs"  

[Webview2ReferenceaddNewBrowserVersionAvailable]: /microsoft-edge/webview2/reference/win32/icorewebview2environment#add_newbrowserversionavailable "add_NewBrowserVersionAvailable |Microsoft Docs"  

[Webview2ReferenceNewBrowserVersionAvailable]: /dotnet/api/microsoft.web.webview2.core.corewebview2environment.newbrowserversionavailable "CoreWebView2Environment.NewBrowserVersionAvailable イベント |Microsoft Docs"  
[WebView2ProcessFailedEvent]: /microsoft-edge/webview2/reference/win32/icorewebview2processfailedeventargs "ICoreWebView2ProcessFailedEventArgs |Microsoft Docs"  

