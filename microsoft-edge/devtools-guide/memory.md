---
description: メモリパネルを使用して、
title: DevTools-Memory
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 03/05/2020
ms.topic: article
ms.prod: microsoft-edge
keywords: microsoft edge、web 開発、f12 ツール、devtools、memory、heap、GC、ガベージコレクション、保持サイズ、dominators
ms.custom: seodec18
ms.openlocfilehash: 416ba144f7e22bd50f5d2a3437bc21d9d31a9035
ms.sourcegitcommit: 6860234c25a8be863b7f29a54838e78e120dbb62
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/09/2020
ms.locfileid: "10569677"
---
# メモリ

**メモリ**パネルを使用して、システムリソースの使用を測定したり、コード実行のさまざまな状態でヒープスナップショットを比較したりします。 これにより、次のことが可能になります。

- [ページのメモリ消費量をリアルタイムでグラフ](#memory-usage-timeline)化し、ヒープのスナップショットを取る
- DOM にアタッチされていない保持オブジェクトなど、コードで発生する[可能性のあるメモリの問題を特定](#snapshot-summary)する
- 問題を特定するためのオブジェクトの種類、インスタンス数、サイズ、参照によって[メモリ使用量データを確認](#snapshot-details)する
- [スナップショットデータフィルターを適用](#filters)して、非実用的な情報のノイズを軽減する
- [特定のオブジェクトのメモリコスト](#object-references)とそれを維持している参照を特定する
- メモリリークおよびその他の問題のソースを追跡するために、[調査のさまざまなフェーズでヒープを比較します](#snapshot-comparison)。

![Microsoft Edge DevTools の [メモリ] パネル](./media/memory.png)


## ツール バー

1. **プロファイリングセッションの開始/停止 (Ctrl + E)**: プロファイラーを有効にすると、メモリ使用量を追跡してヒープのスナップショットを取ることができます。
2. **プロファイルセッションのインポート (Ctrl + O)**: 保存されている devtools メモリ診断セッションを読み込みます。
3. **プロファイルセッションのエクスポート (Ctrl + S)**: 現在の診断セッションをディスクに保存します。
4. **ヒープスナップショットの取得 (Ctrl + Shift + T)**: 指定された時点で現在のメモリ割り当てを記録します。


## メモリ使用量のタイムライン

メモリの問題は、パフォーマンスの問題の主な原因となる可能性があり、その結果、ページの応答が laggy、時間の経過と共に変化します。

ページのメモリ使用量を分析するための最初の手順は、メモリを大量に消費したり、メモリリークが発生したりする可能性がある手順を再現するために、[プロファイルセッションを開始](#toolbar)して、ヒープのスナップショットを作成することです。

メモリプロファイラーを起動すると、プロセスメモリグラフが表示され、時間の経過に伴う全体的なプライベートワーキングセット (ページによって消費されるメモリの量) を監視できます。 メモリグラフには、プライベートバイト、ネイティブメモリ、JavaScript ヒープなど、タブのプロセスメモリのライブビューが表示されます。 

![メモリ使用量のタイムライン](./media/memory_timeline.png)

 グラフでは、予期しないメモリ保持期間が表示された場合など、[ヒープスナップショットの取得](#toolbar)が適切かどうかを判断できるように、ページのメモリの傾向を示すことができます。

### Performance. マーク ()

**User marks** [`Performance.mark()`](https://developer.mozilla.org/docs/Web/API/Performance/mark) コードまたは devtools[**本体**](./console.md)からメソッドを呼び出すことによって、分析セッション中にキーイベントを識別しやすいように、カスタムユーザーマークをタイムラインに追加することができます。

### 本体の Heapheapsnapshot ()

場合によっては、DOM の大きな変異の直前など、特定の時点でスナップショットを作成することが必要な場合があります。 このような場合は、を使用して、プログラムでスナップショットを取得でき [`Console.takeHeapSnapshot()`](./console/console-api.md#taking-heap-snapshots) ます。

## スナップショットの概要

[スナップショットを撮る](#toolbar)と、スナップショットが取得された時点の JavaScript ヒープのサイズと、ページの割り当てられたオブジェクトの数と共に、概要タイルが生成されます。 分析が必要なユーザーシナリオでは、いつでもスナップショットを撮ることができます。 スナップショットは追加のタイルを生成します。各タイルは、前のスナップショットからの JavaScript メモリの違いを示しています。

![ヒープスナップショット](./media/memory_snapshot.png)

[サマリー] タイルの値をクリックすると、[スナップショットデータの詳細](#snapshot-details)が表示されているウィンドウに切り替わります。 潜在的な[メモリの問題は](#snapshot-details)、青色の情報 ("i") アイコンで示されます。

## スナップショットの詳細

[*スナップショット*] ウィンドウのデータには、ページによって作成されたオブジェクトと、JavaScript フレームワークによって割り当てられたメモリが表示されます。

![スナップショットの詳細テーブル](./media/memory_details.png)

3つのタブは、データのさまざまなビューを表します。

#### 型

オブジェクトの種類別にグループ化された、ヒープ上のオブジェクトの数と合計サイズが示されます。 既定では、これらはインスタンス数によって並べ替えられます。

[上の*型*] ウィンドウでオブジェクトを選ぶと、下側のウィンドウの[オブジェクト参照](#object-references)テーブルに、そのオブジェクトを指し示すすべてのオブジェクトが一覧表示されます。

#### 起源

子参照の階層ビューを示して、オブジェクトがグローバルオブジェクトにどのようにルートされるかを説明し、ガベージコレクションされないようにします。

既定では、子ノードは [保持サイズ] 列によって並べ替えられ、最大値は先頭になります。

#### Dominators

他のオブジェクトを排他的に参照するヒープ上のオブジェクトの一覧を示します。 Dominators は保持サイズによって並べ替えられ、オブジェクトが最も簡単に利用できるメモリを大量に消費していることを示します。

ここでは、 *Types、root* 、 *Dominators*の各ビューの列を解釈する方法について説明します。

列 | 説明
:------------ | :-------------
識別子 | オブジェクトを最適に識別する名前。 たとえば、HTML 要素の場合、スナップショットの詳細には ID 属性値が表示されます (存在する場合)。
種類 | オブジェクトの種類 (たとえば、 *HTMLDivElement*)。
Size | オブジェクトのサイズ。参照されているオブジェクトのサイズは含まれません。
保持サイズ | オブジェクトサイズと、他の親がないすべての子オブジェクトのサイズ。 実際には、このオブジェクトによって保持されているメモリの量であるため、オブジェクトを削除した場合は、指定したメモリ量が解放されます。
Count | オブジェクトインスタンスの数。 この値は、[タイプビューでのみ表示されます。

上の*Dominators*ウィンドウでオブジェクトを選ぶと、下側のウィンドウの [[オブジェクト参照](#object-references)] テーブルに、そのオブジェクトをポイントしているすべてのオブジェクトが一覧表示されます。

### フィルター

表のデータをさらに調整するには、次の操作を行います。

![組み込みのアドインとオブジェクト Id をフィルター処理する](./media/memory_filter.png)

1. **識別子フィルター**: 特定のオブジェクト識別子を検索してデータをフィルター処理する
2. **グループ化 dominator**: オブジェクトの最上位のビューには、他のオブジェクトへの*排他*参照を持つオブジェクトのみが表示されます (これは [ *Dominators* ] タブの既定のビューです)。
3. **組み込みのフィルター**: 既定では、JavaScript の[組み込みオブジェクト](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects)がリストに含まれています。 オブジェクト Id の一覧表示は、複数の匿名オブジェクトを区別する必要がある場合に便利です。

*種類、ルート*、 *Dominators*の各ビューにはそれぞれ専用のフィルターがあります。そのため、別のビューに切り替えると、フィルターは保持されません。

### オブジェクト参照

[**Types**](#types)ビューと[**Dominators**](#dominators)ビューでは、下部ウィンドウには共有参照を表示する**オブジェクト参照**リストが含まれています。 上のウィンドウでオブジェクトを選ぶと、そのオブジェクトをポイントしているすべてのオブジェクトが表示されます。つまり、選択したオブジェクトをアクティブな状態に維持しているオブジェクトを示します。

循環参照には、アスタリスク (*) と情報のヒントが表示され、展開することはできません。 そうしないと、参照ツリーをウォークしたり、メモリを保持しているオブジェクトを識別したりすることができなくなります。

同等のオブジェクトをすばやく識別するには、[ *id* ] 列でオブジェクト名の横にオブジェクト id を表示するには、[[*オブジェクト id の表示*](#filters)] フィルターオプションをオンにします。 同じ ID を持つオブジェクトは共有参照です。

### スナップショットの比較

[[スナップショットの概要] タイル](#snapshot-summary)の [スナップショットの[比較] タブ](#snapshot-details)または [比較] リンクをクリックすると、2つのスナップショット間の情報の相違が表示されます。 [比較] ウィンドウで、 *Dominators、Types* 、および*root*の各ビューには、1つのスナップショットに対して表示されるのと同じ[*スナップショットの詳細*](#snapshot-details)が用意されています。次のような追加の値があります。

列 | 説明
:------------ | :-------------
サイズの相違。 | 現在のスナップショット内のオブジェクトのサイズと前のスナップショットのサイズの違い。参照先のオブジェクトのサイズは含まれません。
保持されているサイズの差分。 | 現在のスナップショット内のオブジェクトの保持サイズと、以前のスナップショットで保持されているサイズの差。 保持されるサイズには、オブジェクトサイズと、他の親を持たないすべての子オブジェクトのサイズが含まれます。 実際には、保持されるサイズは、オブジェクトによって保持されているメモリの量であるため、オブジェクトを削除した場合、指定したメモリ量が解放されます。

**スコープ**ドロップダウンを使用して、スナップショット間の差分情報をフィルター処理することができます。

![スナップショット comparisions のスコーピング filter](./media/memory_comparison_scope_filter.png)

- <strong>[Snapshot から] に残ったオブジェクト <number></strong> : ヒープに追加されたオブジェクトと、ベースラインスナップショットから以前のスナップショットへのヒープから削除されたオブジェクトの相違点を示します。 たとえば、[スナップショットの概要] が [ <em> オブジェクト数] に + 205/-195 と表示されている場合、 </em> このフィルターでは、追加したが削除されていない10個のオブジェクトが表示されます。

- <strong>Snapshot # と #: の間に追加されたオブジェクト <number> <number></strong> は、前のスナップショットからヒープに追加されたすべてのオブジェクトを示しています。

- <strong>Snapshot のすべてのオブジェクト <number></strong> : ヒープ上のすべてのオブジェクトを表示します (つまり、フィルター処理さ <em> </em> れていないビュー)。

既定では、[*一致しない参照を表示する]* フィルターが比較ビューに適用され、現在のスコープフィルターに一致しないオブジェクト参照が示されます。 この機能は、ドロップダウンメニューからオフにすることができます。

![スナップショット比較の一致しない参照フィルター](./media/memory_comparison_matching_filter.png)


## ショートカット

 操作 | キー
:------------ | :-------------
プロファイリングセッションの開始/停止  | `Ctrl` + `E`
プロファイルセッションのインポート | `Ctrl` + `O`
プロファイリングセッションのエクスポート | `Ctrl` + `S`
ヒープスナップショットの取得 | `Ctrl` + `Shift` + `T`

## 既知の問題

### プロファイルセッションの開始中にエラーが発生しました

このエラーメッセージが表示される場合: メモリツールで**プロファイリングセッションを開始するときにエラーが発生しまし**た。回避策については、次の手順を実行してください。

1. キーを押し `Windows Key`  +  `R` ます。

2. [実行] ダイアログボックスで、「 **services.msc**」と入力します。
![既知の問題-1](./media/known_issues_1.PNG)

3. **Microsoft (R) Diagnostics Hub Standard コレクタサービス**を探して右クリックします。
![既知の問題-2](./media/known_issues_2.PNG)

4. **Microsoft (R) Diagnostics Hub Standard コレクタサービス**を再起動します。
![既知の問題-3](./media/known_issues_3.PNG)

5. Microsoft Edge 開発者ツールとタブを閉じます。新しいタブを開き、目的のページに移動して、キーを押し `F12` ます。

6. これで、プロファイリングを開始できるようになります。 
![既知の問題-4](./media/known_issues_4-memory.PNG)

まだ問題が発生していますか? フィードバックの**送信**アイコンを使ってフィードバックをお送りください。 

![既知の問題-5](./media/known_issues_5.PNG)
