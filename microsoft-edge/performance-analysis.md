---
ms.assetid: 7a5f9fd0-90a9-43db-b271-178c06da5896
description: F12 開発者ツールを使用して、web サイトの全般的なパフォーマンスを分析します。
title: パフォーマンスの分析
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 02/08/2017
ms.topic: article
ms.prod: microsoft-edge
keywords: edge、web 開発、html、css、javascript、開発者
ms.openlocfilehash: 7bf71744298502c9edf8ee1262fceff5640bedf1
ms.sourcegitcommit: 6860234c25a8be863b7f29a54838e78e120dbb62
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/09/2020
ms.locfileid: "10570749"
---
# パフォーマンスの分析

パフォーマンスを初めて使用する場合は、 [F12 DevTools のガイド](./devtools-guide.md)をご覧ください。
Microsoft Edge に組み込まれている[F12 ツール](./devtools-guide.md)を使って、web サイトの全般的なパフォーマンスを分析できます。 これにより、ブラウザー内で、 [Windows パフォーマンスツールキット](https://docs.microsoft.com/windows-hardware/test/wpt/index)の機能が (さらに制限されています) 機能が提供されます。



ブラウザーのパフォーマンスをさらに詳しく分析する場合は、Microsoft Edge チームは[Windows Performance Toolkit](https://docs.microsoft.com/windows-hardware/test/wpt/index) (WPT) を使います。 WPT は、Windows チームによって作成され、詳細なプログラムパフォーマンス分析を実施しました。 Web サイトの JavaScript と Microsoft Edge のネイティブコードの間の境界を straddles することで、同じツール内で両方を表示できます。 WPT は、次のように使用できます。
 - ソフトウェアが作業を完了するのに要した CPU 時間を測定する
 - ソフトウェアによって割り当てられたメモリを計算する
 - リモートサーバーからのファイルのダウンロードの詳細を表示する
 - フレームレートを測定します。


Windows パフォーマンスツールキットを使って web サイトを分析する方法については、まず[windows 10 評価と展開キット (ADK)](https://developer.microsoft.com/windows/hardware/windows-assessment-deployment-kit)をダウンロードする必要があります。 インストール中に*Windows パフォーマンスツールキット*オプションを選択します。

![ADK インストールオプション](./media/adk-installoptions.png)

ここでは、パフォーマンストレースを記録して分析する方法について説明します。 Windows Performance Toolkit の詳細については、 [WPT のドキュメント](https://docs.microsoft.com/windows-hardware/test/wpt/index)を参照してください。

## トレースの記録
次に、ユーザーシナリオをセットアップして、Windows パフォーマンスレコーダーを使ってトレースを収集する準備をします。
ここでは、 *Windows パフォーマンスレコーダー (WPR)* を使って web シナリオのプロファイリングを行う方法について説明します。

### 1. パフォーマンス追跡を収集するための環境の準備
記録しようとしているトレースのノイズを回避するため、できるだけ多くの実行プログラムを終了します。 理想的には、実行されている唯一のソフトウェアが Windows Performance レコーダー (WPR) とブラウザーです。

### 2. Windows パフォーマンスレコーダー (WPR) を起動し、オプションを選択する
Windows パフォーマンスレコーダーを起動し、[**その他のオプション]** トグルが展開されていることを確認します。 [ *Edge Browser* ] および [ *HTML 応答性*のシナリオ分析] チェックボックスをオンにします。

![Windows のパフォーマンスレコードのオプション](./media/wprui-options.png)

#### トレースを収集するためのヒント
- バックグラウンドアクティビティを絶対に必要最小限に抑えてください。 バックグラウンドプロセスは、体感されているパフォーマンスと実際のパフォーマンスの特性の両方をスキューし、結果に影響を与える可能性があります。 ブラウザーと WPR の間に他のアプリケーションが実行されていないことが理想的です。
- 分析するシナリオを特定し、できるだけアトミックな状態にしておきます。 たとえば、ページの読み込み時にパフォーマンスの問題が発生したり、表内の何かを選択したりすると、問題が次の3つのシナリオに分類されます。
  - ページの読み込み (ナビゲーションの最初からページの読み込み完了まで)
  - Scroll
  - 表の内容を選択する
- シナリオによってサイトへの移動が必要な場合は、[詳細情報] からシナリオを開始することを検討してください。 [About: blank] から開始すると、前のページのオーバーヘッドを回避できます。 サイトから移動する必要がある場合は、[about: blank] に移動してシナリオを完了します。 これにより、サイト間の特定の操作が調査の問題である場合を除いて、他のサイトのトレースが不要になります。

### 3. シナリオを記録する
[**開始**] をクリックして録音を開始します。 このツールは、生成されたファイルのサイズを予測するのに役立つように、使用しているバッファーのサイズを報告します。 測定するユーザーシナリオを実行し、[**保存**] をクリックして記録を停止し、トレースを保存します。 シナリオを終了した直後に保存することで、トレースファイルのサイズを最小限に抑えることができます。

![Windows パフォーマンスレコードの開始](./media/wprui-recording.png)

WPR ツールは、トレース情報が正常に保存されたことを示します。

![Windows パフォーマンスレコードの開始](./media/wprui-savecomplete.png)


## トレースの分析
パフォーマンスデータを収集したので、Windows Performance Analyzer を使ってトレースを分析し、最適化できることを確認することができます。
ここでは、web シナリオのパフォーマンスデータを分析する方法について説明します。

### 1. Windows Performance Analyzer (WPA) を開く
Windows Performance Analyzer を起動して、分析するファイルを開きます `.etl` (**File**  >  **[** ファイル])。

### 2. シンボルを読み込み、 *HTML 分析*プロファイルを適用する

>[!WARNING]
> シンボルを初めて読み込むときには、大規模なダウンロードが必要となり、通常のインターネット接続ではかなりの時間がかかります。

メニューから [**トレース**  >  ] [**シンボルの読み込み**] を選択して、シンボルを読み込みます。 シンボルはディスクにキャッシュされ、将来のトレースではシンボルの読み込みが大幅に高速化されます。

Microsoft Edge と web apps ホストへの読み込みを制限することで、シンボルを大幅に読み込むことができます。 [**トレース**の設定] を選択し  >  **Configure Symbols** 、[**読み込みの設定**] のみを [] に制限し `MicrosoftEdgeCP.exe` `WWAHost.exe` ます。

![記号の制限](./media/wpa-symbolrestrictions.png)

記号の読み込みが開始されたら、 *Html 分析プロファイル*を適用します (**プロファイル**が適用されます..  >  **.**  > **カタログを参照...**  > **HtmlResponsivenessAnalysis プロファイル**は、分析用にいくつかのグラフとテーブルを読み込みます。 ほぼすべての web サイトの調査で、このプロフィールから始めることをお勧めします。

![全体像](./media/wpa-bigpicture.png)


#### Html 応答解析プロファイル
*Html 応答*解析プロファイルには、次の4つのタブが用意されています。

**大きな画像**-これは、CPU アクティビティの予期しないソースがなく、ブラウザーが利用可能なすべてのリソースを実際に使用していることを確認するために役立ちます。 CPU 使用量を確認して、ブラウザー以外の CPU 使用量に対して大幅に影響するプロセスがないことを確認します。

**フレームの分析**-このセクションは基本的な分析に使用されます。 [ *Cpu 使用量]* グラフでは、cpu 使用量を把握するサブシステムについて簡単に説明します。 *HTML UI スレッド*の*CPU 使用率 (サンプリング)* テーブルでサンプルを分解すると、重大なパフォーマンスのボトルネックを特定するのに役立ちます。

**トレースマーカー** -このセクションには、ブラウザー (Microsoft Edge) からのすべてのトレースマーカーが表示されます。これにより、 *msWriteProfilerMark*が含まれます。これにより、コードの正確な測定方法が示されます。 *MsWriteProfilerMark*トレースを表示するには、[*汎用イベント*] グラフまで下にスクロールして、ドロップダウンメニューから [ **HTML msWriteProfilerMark** ] を選びます。

**スレッド遅延分析**-このタブは、あるスレッドがブロックされ、別のスレッドが待機しているときに、Microsoft Edge 開発者によって調査されることがよくあります。 まれに、web 開発者にとっても便利な場合があります。


### 3. トレースの停止を削除するためのズームダウン
グラフの空の末尾の*トレースダウン*セクションを削除することで、分析に焦点を合わせることができます。 現在表示されているグラフから:
 - 調べるグラフデータの先頭を左クリックします。
 - ホールドし、ドラッグして解放し、目的の地域を選びます。
 - 右クリックして、[**ズーム**] を選択します。

ズームは、アクティブなタブ上のすべてのグラフとグラフに適用されます。

![ズーム後](./media/wpa-postzoom.png)


### 4. CPU サイクルの消費を調査する
 [**フレーム分析**] タブの [ **CPU 使用率 (サンプリング)** ] テーブルには、ほとんどの分析が行われる可能性があります。 さまざまなプロセスを展開して、最も負荷の高い JavaScript とブラウザーコードを特定することができます。 多くの場合、JavaScript の1ビットはパフォーマンスの問題に対応しており、そのために時間をかけて最適化を行うことができます。

### 5. 実行速度が遅い JavaScript コードを詳しく調べる
ボトムアップ DOM 呼び出しの分析は、シナリオ中に多くの時間を取る JavaScript を特定するのに役立ちます。 これは、多くのトップレベルの呼び出しが同じ JavaScript ライブラリを再利用する場合に特に便利です。

まず *、プロセス、スレッド、アクティビティ、スタックで CPU 使用率 (サンプリング*された) の内訳を見ていきます。 [**スタック**] 列の任意のセルをクリックします。 Ctrl キーを押し*ながら F*キーを押し、 *externalfunctionthunk*を検索します。

>[!NOTE] 
>この操作は、正常にシンボルが読み込まれている場合にのみ有効です。

![ExternalFunctionThunk を検索する](./media/wpa-externalfunctionthunk.png)

*Externalfunctionthunk*を使って、任意の行を調査します。 これは、Chakra JavaScript エンジンから Microsoft Edge エンジンへのインターフェイスです。 ブラウザーから JavaScript 実行へのコードブリッジの場所を示します。 線を右クリックして、[**呼び出し**先の一覧を表示] を選択すると、実行時間が  >  **By Module**長いブラウザーエンジン関数の加重リストが表示されます。

![呼び出し先の表示](./media/wpa-viewcallees.png)

特定の API を呼び出すすべての JavaScript を特定するには、その API を右クリックし、[関数別の**呼び出し元の表示**] を選択して、  >  **By Function**相対的な重みを表示して比較します。
